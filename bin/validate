#!/usr/bin/env ruby
# frozen_string_literal: true

# link:docs/features/validation.md
# Command-line tool to validate CSV files for the mini trade game dataset.
# Ensures JSON validity and game mechanics constraints.

require_relative '../lib/dataset'
require_relative '../lib/validation'
require_relative '../lib/validator/json_syntax'
require_relative '../lib/validator/schema_validator'
require_relative '../lib/validator/rarity_validator'
require_relative '../lib/validator/relationship_validator'
require_relative '../lib/validator/expected_price_validator'
require_relative '../lib/validator/price_range_validator'

if ARGV.empty?
  puts "Usage: bundle exec ruby bin/validate path/to/your/file.csv"
  exit 1
end

file_path = ARGV[0]

unless File.exist?(file_path)
  puts "Error: File '#{file_path}' not found"
  exit 1
end

dataset = Dataset.new(file_path)
validators = [
  Validator::RarityValidator.new,
  Validator::RelationshipValidator.new,
  Validator::ExpectedPriceValidator.new,
  Validator::JsonSyntax.new,
  Validator::SchemaValidator.new,
  Validator::PriceRangeValidator.new
]
validation = Validation.new(dataset, validators)

errors = validation.execute

if errors.empty?
  exit 0
else
  puts errors.join("\n")
  exit 1
end
