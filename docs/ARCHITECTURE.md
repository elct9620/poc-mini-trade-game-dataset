# Architecture

This document outlines the architecture of script to validate dataset.

## Structure

In this project, the scripts are used to help validate the dataset.

```
|- bin/
    |- validate # The entrypoint script to validate the dataset
|- lib/
    |- validator/
        |- json_syntax.rb # Syntax Validator
        |- schema_validator.rb # Schema Validator
    |- dataset.rb    # Dataset Loader
    |- validation.rb # The usecase to validate the dataset
|- spec/ # RSpec tests
    |- validator/
        |- json_syntax_spec.rb
        |- schema_validator_spec.rb
    |- dataset_spec.rb
|- docs/
    |- features/
        |- validation.md # Feature description, usage, acceptance criteria
    |- ARCHITECTURE.md # This document
```

## Dataset

The dataset is a CSV file with the following columns:

- `id`: Unique identifier for each example.
- `item_name`: The name of the item being traded.
- `item_rarity`: The rarity of the item (e.g., Common, Rare, Epic).
- `item_expected_price`: The expected price of the item.
- `relationship_status`: The current relationship status with the player (e.g., Hostile, Neutral, Friendly, Allied).
- `input`: The input prompt used to generate the example.
- `output`: The output generated by the model.

The `Dataset` class in `lib/dataset.rb` is responsible for loading and parsing the CSV file.

## Validators

Each row in the dataset is validated by various validators based on the requirements.

```ruby
module Validator
  class BaseValidator
    def validate(row)
      raise NotImplementedError, "Subclasses must implement the validate method"
    end
  end
end
```

- Raise `ValidationError` if validation fails with a descriptive message.
- Return `true` if validation passes.

## Usecase

The usecase is used by `bin/` to validate or process the dataset.

```ruby
class Validation
  def initialize(dataset, validators)
    @dataset = dataset
    @validators = validators
  end

  def execute
    errors = []

    @dataset.each_with_index do |row, index|
      @validators.each do |validator|
        validator.validate(row)
      rescue ValidationError => e
        errors << "Row #{index + 1}: #{e.message}"
      end
    end

    errors
  end
end
```

- Use dependency injection to pass the dependencies (dataset, validators).
- Use simple data structures (arrays, hashes) to represent data.
